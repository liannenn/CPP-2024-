#include <iostream>
#include <iomanip>
#include <string>

using namespace std;

const int NUM_DRINKS = 5;

struct Drink {
    string name;
    double cost;
    int quantity;
};

// Line 30: This code was generated by ChatGPT.

void showMenu(Drink drinks[]);
int getChoice();
double getMoney(double cost);
void processSale(Drink& drink, double& totalSales);

int main() {
    Drink drinks[NUM_DRINKS] = {
        {"Cola", 0.75, 20},
        {"Root Beer", 0.75, 20},
        {"Lemon-Lime", 0.75, 20},
        {"Grape Soda", 0.80, 20},
        {"Cream Soda", 0.80, 20}
    };

    double totalSales = 0.0;
    int choice;

    do {
        showMenu(drinks);
        choice = getChoice();

        if (choice >= 0 && choice < NUM_DRINKS) {
            if (drinks[choice].quantity == 0) {
                cout << "Sorry, " << drinks[choice].name << " is sold out.\n";
                continue;
            }

            double moneyInserted = getMoney(drinks[choice].cost);
            if (moneyInserted < 0) {
                cout << "Invalid amount.\n";
                continue;
            }

            if (moneyInserted < drinks[choice].cost) {
                cout << "Not enough money inserted. Returning $" 
                     << fixed << setprecision(2) << moneyInserted << ".\n";
                continue;
            }

            processSale(drinks[choice], totalSales);
            double change = moneyInserted - drinks[choice].cost;

            cout << "Dispensing " << drinks[choice].name << ". ";
            cout << "Change returned: $" << fixed << setprecision(2) << change << "\n";
        }

    } while (choice != NUM_DRINKS); // Quit option is NUM_DRINKS

    cout << "\nTotal earnings: $" << fixed << setprecision(2) << totalSales << "\n";
    return 0;
}

void showMenu(Drink drinks[]) {
    cout << "\nWelcome to the Drink Machine!\n";
    for (int i = 0; i < NUM_DRINKS; ++i) {
        cout << i + 1 << ". " << drinks[i].name
             << " - $" << fixed << setprecision(2) << drinks[i].cost
             << " (" << drinks[i].quantity << " left)\n";
    }
    cout << NUM_DRINKS + 1 << ". Quit\n";
}

int getChoice() {
    int choice;
    cout << "Select a drink (1â€“" << NUM_DRINKS + 1 << "): ";
    cin >> choice;

    if (cin.fail() || choice < 1 || choice > NUM_DRINKS + 1) {
        cin.clear();
        cin.ignore(1000, '\n');
        cout << "Invalid selection.\n";
        return -1;
    }

    return (choice == NUM_DRINKS + 1) ? NUM_DRINKS : choice - 1;
}

double getMoney(double cost) {
    double amount;
    cout << "Insert money ($0.00 to $1.00): ";
    cin >> amount;

    if (cin.fail() || amount < 0 || amount > 1.00) {
        cin.clear();
        cin.ignore(1000, '\n');
        return -1.0;
    }

    return amount;
}

void processSale(Drink& drink, double& totalSales) {
    drink.quantity--;
    totalSales += drink.cost;
}
